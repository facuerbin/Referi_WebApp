<div class="container-fluid m-3 main-container">
  <section class="container-fluid">
    <div class="row">
      <h2>Detalle de la Actividad:</h2>
    </div>
    <form [formGroup]="actividadForm" class="row">
      <div class="col-md-5 col-s-12 mt-3 position-relative">
        <div class="img-container">
          <img
            *ngIf="actividad"
            src="{{ imgUrl }}"
            alt="imagen de la actividad"
            class="profile-img"
          />
          <label class="upload-image" for="file">
            <fa-icon [icon]="pencil" aria-hidden="true"></fa-icon>
          </label>
        </div>
        <input
          type="file"
          class="d-none"
          id="file"
          (change)="onChange($event)"
        />
      </div>
      <div class="col-md-6 col-s-12">
        <h3>Datos de la Actividad</h3>

        <div class="container-fluid row">
          <div class="form-group">
            <label for="nombre">Nombre:</label>
            <input
              type="text"
              class="form-control"
              id="nombre"
              placeholder="Nombre"
              formControlName="nombre"
              value="{{ actividad?.nombre }}"
            />
            <p *ngIf="isValid('nombre')" class="form-error">
              Por favor asignele un nombre a la actividad
            </p>
          </div>

          <div class="form-group">
            <label for="descripción">Descripción:</label>
            <input
              type="text"
              class="form-control"
              id="descripcion"
              placeholder="Descripción"
              formControlName="descripcion"
              value="{{ actividad?.descripcion }}"
            />
            <p *ngIf="isValid('descripcion')" class="form-error">
              Por favor asignele un descripción a la actividad
            </p>
          </div>

          <div class="form-group">
            <label for="idTipoActividad">Tipo de Actividad:</label>
            <select
              class="form-control"
              id="tipo"
              formControlName="idTipoActividad"
              [value]="actividad?.tipo?.id"
            >
              <option *ngFor="let tipo of tipoActividad" value="{{ tipo.id }}">
                {{ tipo.tipo }}
              </option>
            </select>
            <p *ngIf="isValid('idTipoActividad')" class="form-error">
              Por favor asignele un tipo a la actividad
            </p>
          </div>

          <div class="form-group form-group-small">
            <label for="fecha">Fecha de creacion:</label>
            <input
              type="text"
              class="form-control"
              id="fecha"
              placeholder="Fecha de inicio"
              value="{{ helper.parseDate(fechaCreacion) }}"
              disabled
              style="background-color: white; border: none"
            />
          </div>

          <div class="form-group form-group-small">
            <label for="cupo">Cupo:</label>
            <input
              type="number"
              class="form-control form-control-small"
              id="cupo"
              placeholder="Cupo"
              formControlName="cupo"
              value="{{ actividad?.cupo }}"
            />
            <p *ngIf="isValid('cupo')" class="form-error">
              Por favor asignele un nombre a la actividad
            </p>
          </div>

          <div class="form-group d-flex justify-content-center">
            <button class="btn btn-primary" (click)="saveUpdate()">
              GUARDAR CAMBIOS
            </button>
          </div>
          <p class="success text-center" *ngIf="updateSuccess">
            Los cambios se guardaron correctamente...
          </p>
        </div>
      </div>
    </form>
  </section>

  <section class="row">
    <article class="col-md-6 col-sm-12 table-section">
      <h3>Tarifas</h3>
      <div class="table-wrapper">
        <table
          class="table table-striped table-hover table-bordered table-responsive"
        >
          <thead>
            <tr>
              <th scope="col">Nombre</th>
              <th scope="col">Monto</th>
              <th scope="col">Frecuencia</th>
              <th scope="col">¿Es opcional?</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tarifa of tarifas; let i = index">
              <td>{{ tarifa.nombre }}</td>
              <td>{{ tarifa.monto }}</td>
              <td>{{ tarifa.frecuencia.nombre }}</td>
              <td>{{ tarifa.esOpcional ? "Sí" : "No" }}</td>
            </tr>
          </tbody>
        </table>
        <h2 class="text-center" *ngIf="tarifas.length == 0">No hay tarifas cargadas aún</h2>
      </div>

        <button class="btn btn-primary mt-3" (click)="openModalTarifas()">
          NUEVA TARIFA
        </button>
    </article>

    <article class="col-md-6 col-sm-12">
      <h3>Horarios</h3>

      <div class="table-wrapper">
        <table
          class="table table-striped table-hover table-bordered table-responsive"
        >
          <thead>
            <tr>
              <th scope="col">Turno N°</th>
              <th scope="col">Horarios</th>
              <th scope="col">Inscriptos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let turno of turnosArray; let i = index">
              <td>{{ i + 1 }}</td>
              <td>
                <ul>
                  <li *ngFor="let horario of turnosStrings[i]">
                    {{ horario }}
                  </li>
                </ul>
              </td>
              <td>{{ turno.inscriptos.length }}</td>
            </tr>
          </tbody>
        </table>
        <h2 class="text-center" *ngIf="turnosArray.length == 0">No hay turnos cargados aún</h2>
      </div>

        <button class="btn btn-primary mt-3" (click)="openModalHorarios()">
          NUEVO HORARIO
        </button>

    </article>
  </section>
</div>

<!-- Modale Crear Tarifa -->
<div class="modal fade" tabindex="-1" id="modalTarifas">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Crear Tarifa:</h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          (click)="closeModalTarifas()"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-12">
            <form
              [formGroup]="tarifasForm"
              class="container-fluid"
              *ngIf="load"
            >
              <div class="row">
                <div class="col-10 col-sm">
                  <h3>Datos de la Tarifa</h3>
                  <div class="form-group">
                    <input
                      type="text"
                      class="form-control"
                      id="nombreTarifa"
                      placeholder="Nombre"
                      formControlName="nombreTarifa"
                    />
                    <p *ngIf="isValidTarifa('nombreTarifa')" class="form-error">
                      Por favor asignele un nombre a la tarifa
                    </p>
                  </div>
                  <div class="form-group">
                    <select
                      class="form-control"
                      id="frecuancia"
                      formControlName="frecuencia"
                      [value]=""
                    >
                      <option value="" disabled selected>
                        Seleccione la frecuencia de la tarifa
                      </option>
                      <option
                        *ngFor="let frecuencia of frecuencias"
                        value="{{ frecuencia.nombre }}"
                      >
                        {{ frecuencia.nombre }}
                      </option>
                    </select>
                    <p *ngIf="isValidTarifa('frecuencia')" class="form-error">
                      Por favor asignele una frecuencia a la tarifa
                    </p>
                  </div>
                  <div class="form-group">
                    <input
                      type="number"
                      class="form-control"
                      id="monto"
                      placeholder="Monto de la tarifa"
                      formControlName="monto"
                    />
                    <p *ngIf="isValidTarifa('monto')" class="form-error">
                      Por favor asignele un monto a la tarifa
                    </p>
                  </div>
                  <div class="form-group">
                    <label> ¿Es una tarifa opcional?</label>
                    <input
                      type="checkbox"
                      class="m-4"
                      id="tarifaOpcion"
                      formControlName="tarifaOpcional"
                      value="false"
                    />
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer justify-content-center">
            <button
              type="button"
              class="btn btn-primary"
              (click)="handleTarifasForm()"
              [disabled]="tarifasForm.invalid"
            >
              <span
                class="spinner-border spinner-border-sm"
                role="status"
                aria-hidden="true"
                *ngIf="spinner"
              ></span>
              AGREGAR TARIFA
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modale Crear Turno -->
<div class="modal fade" tabindex="-1" id="modalHorarios">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Agregar Turno:</h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          (click)="closeModalTarifas()"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-12">
            <form
              [formGroup]="horariosForm"
              class="container-fluid"
              *ngIf="load"
            >
              <div class="row">
                <div class="col-10 col-sm">
                  <h3>Turno:</h3>
                  <div class="form-group">
                    <select class="form-control" id="dia" formControlName="dia">
                      <option value="" disabled selected>
                        Selecciona el día
                      </option>
                      <option *ngFor="let dia of dias" value="{{ dia }}">
                        {{ dia }}
                      </option>
                    </select>
                    <p *ngIf="isValidHorario('dia')" class="form-error">
                      Por favor seleccione un día
                    </p>
                  </div>

                  <div class="form-group d-flex align-items-center">
                    <label for="horaInicio" class="m-3">Hora de inicio:</label>
                    <input
                      type="number"
                      min="0"
                      max="23"
                      class="form-control time-input"
                      id="horaInicio"
                      placeholder="hh"
                      formControlName="horaInicio"
                      onKeyPress="if(this.value.length==2) return false;"
                    />

                    <p>:</p>

                    <input
                      type="number"
                      onkeydown="return event.keyCode !== 69"
                      min="0"
                      max="59"
                      class="form-control time-input"
                      id="minutosInicio"
                      placeholder="mm"
                      formControlName="minutosInicio"
                      [defaultValue]="00"
                      onKeyPress="if(this.value.length==2) return false;"
                    />
                    <p
                      *ngIf="isValidHorario('minutosInicio')"
                      class="form-error"
                    >
                      Por favor asignele minutos al horario
                    </p>
                    <p *ngIf="isValidHorario('horaInicio')" class="form-error">
                      Por favor asignele una hora al horario
                    </p>
                  </div>

                  <section class="form-group d-flex align-items-center">
                    <label for="duracion" class="m-2">Duración:</label>
                    <input
                      type="number"
                      onkeydown="return event.keyCode !== 69"
                      class="form-control time-input w-25 text-center"
                      id="duracion"
                      placeholder="minutos"
                      formControlName="duracion"
                      onKeyPress="if(this.value.length==3) return false;"
                    />
                  </section>

                  <div class="form-group">
                    <select
                      class="form-control"
                      id="espacioSelect"
                      formControlName="espacio"
                      [value]=""
                    >
                      <option value="" disabled selected>
                        Selecciona el espacio
                      </option>
                      <option
                        *ngFor="let espacio of espacios"
                        value="{{ espacio.id }}"
                      >
                        {{ espacio.nombre }}
                      </option>
                    </select>
                    <p *ngIf="isValidHorario('espacio')" class="form-error">
                      Debe asignar un espacio
                    </p>
                  </div>
                </div>
              </div>
            </form>

            <p *ngFor="let turno of horariosStrings">
              {{ turno }}
            </p>
          </div>
          <div class="modal-footer justify-content-center">
            <button
              type="button"
              class="btn btn-secondary m-3"
              (click)="handleHorariosForm()"
              [disabled]="horariosForm.invalid"
            >
              <span
                class="spinner-border spinner-border-sm"
                role="status"
                aria-hidden="true"
                *ngIf="spinner"
              ></span>
              AGREGAR HORARIO
            </button>

            <button
              type="button"
              class="btn btn-primary"
              (click)="crearTurno()"
              [disabled]="horariosArray.length == 0"
            >
              <span
                class="spinner-border spinner-border-sm"
                role="status"
                aria-hidden="true"
                *ngIf="spinner"
              ></span>
              CREAR TURNO
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
